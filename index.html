<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>Discount Calculator</title>
    <meta name="apple-mobile-web-app-title" content="Discount Calc">
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="theme-color" content="#121e25">
    <meta name="description" content="A secure, accessible offline discount calculator.">

    <style>
        :root {
            /* Palette extracted from the screenshot */
            --bg-body: #121e25;        /* Deep dark blue/black */
            --bg-hero: #004b49;        /* Teal hero card */
            --bg-card: #28333e;        /* Dark blue/grey cards */
            --bg-keypad-btn: #1e2a32;  /* Slightly darker btn */
            --text-main: #ffffff;
            --text-muted: #8498a3;
            --accent: #53d0ec;         /* Bright cyan text for contrast */
            --accent-soft: rgba(83, 208, 236, 0.2);
            --focus-ring: 0 0 0 3px rgba(83, 208, 236, 0.5);
            --radius: 16px;
        }

        /* Accessibilty: Focus visibility */
        *:focus-visible {
            outline: none;
            box-shadow: var(--focus-ring);
            z-index: 10;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden; /* Prevent scrolling */
            display: flex;
            flex-direction: column;
            padding: env(safe-area-inset-top) 1rem env(safe-area-inset-bottom) 1rem;
        }

        /* --- LAYOUT GRID --- */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-width: 450px;
            margin: 0 auto;
            width: 100%;
            gap: 1rem;
            padding-top: 1rem;
        }

        /* --- 1. HERO SECTION (Price) --- */
        .hero-card {
            background-color: var(--bg-hero);
            border-radius: var(--radius);
            flex: 0 0 auto; /* Don't stretch */
            padding: 1.5rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .hero-label {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .hero-value {
            font-size: 3.5rem;
            font-weight: 700;
            color: #ffffff;
            /* Monospace numbers prevent jumping when typing */
            font-variant-numeric: tabular-nums; 
        }

        /* --- 2. INFO GRID (2x2) --- */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.8rem;
            flex: 0 0 auto;
        }

        .card {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
        }

        .card label {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .card-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-main);
            font-variant-numeric: tabular-nums;
        }
        
        /* Highlight result values */
        .result-text { color: var(--text-main); }
        .accent-text { color: var(--accent); }

        /* Inputs inside cards (Hidden native appearance, styled custom) */
        .input-bare {
            background: transparent;
            border: none;
            color: var(--accent);
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            width: 60px;
            padding: 0;
            -moz-appearance: textfield;
        }
        .input-bare:focus {
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
        }
        .input-row {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .percent-symbol {
            color: var(--text-muted);
            font-size: 1rem;
            margin-left: 2px;
        }

        /* Custom Slider (Mini) */
        input[type=range] {
            -webkit-appearance: none;
            width: 80%;
            background: transparent;
            margin-top: 8px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px; width: 12px;
            border-radius: 50%;
            background: var(--accent);
            margin-top: -4px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            cursor: pointer;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
        }

        /* Tax Toggle (Mini Switch) */
        .mini-switch {
            position: absolute;
            top: 10px; right: 10px;
            width: 24px; height: 14px;
        }
        .mini-switch input { opacity: 0; width: 0; height: 0; }
        .mini-slider {
            position: absolute; cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #4a555e;
            border-radius: 34px; transition: .4s;
        }
        .mini-slider:before {
            position: absolute; content: "";
            height: 10px; width: 10px;
            left: 2px; bottom: 2px;
            background-color: white;
            border-radius: 50%; transition: .4s;
        }
        input:checked + .mini-slider { background-color: var(--accent); }
        input:checked + .mini-slider:before { transform: translateX(10px); }

        /* --- 3. KEYPAD (Bottom) --- */
        .keypad {
            flex: 1; /* Takes remaining space */
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.8rem;
            margin-top: auto; /* Push to bottom */
            padding-bottom: 1rem;
        }

        .key-btn {
            background-color: var(--bg-keypad-btn);
            border: none;
            border-radius: 12px;
            color: var(--text-main);
            font-size: 1.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.1s;
            user-select: none;
        }
        .key-btn:active { background-color: #384550; }
        
        .key-ac { color: #ff6b6b; font-size: 1.4rem; font-weight: 700; }
        .key-back svg { width: 28px; height: 28px; fill: var(--text-main); }
    </style>
</head>
<body>

<main class="app-container">

    <section class="hero-card" aria-label="Original Price Display">
        <div class="hero-label">Bill Total</div>
        <div class="hero-value" id="display-price">0.00</div>
    </section>

    <section class="info-grid">
        
        <div class="card">
            <label for="discount-input">Discount</label>
            <div class="input-row">
                <input type="number" id="discount-input" class="input-bare" value="0" min="0" max="100" onfocus="this.select()">
                <span class="percent-symbol">%</span>
            </div>
            <input type="range" id="discount-slider" min="0" max="100" value="0" aria-label="Discount slider">
        </div>

        <div class="card" aria-live="polite">
            <label>You Save</label>
            <div class="card-value accent-text" id="display-saved">0.00</div>
        </div>

        <div class="card">
            <label for="tax-input">Tax</label>
            <label class="mini-switch" aria-label="Toggle Tax">
                <input type="checkbox" id="tax-toggle">
                <span class="mini-slider"></span>
            </label>
            
            <div class="input-row" id="tax-container" style="opacity: 0.3; transition: opacity 0.3s;">
                <input type="number" id="tax-input" class="input-bare" value="7.0" onfocus="this.select()">
                <span class="percent-symbol">%</span>
            </div>
        </div>

        <div class="card" aria-live="polite">
            <label>Total</label>
            <div class="card-value result-text" id="display-total">0.00</div>
        </div>

    </section>

    <section class="keypad" aria-label="Numeric Keypad">
        <button class="key-btn" onclick="pressKey('7')">7</button>
        <button class="key-btn" onclick="pressKey('8')">8</button>
        <button class="key-btn" onclick="pressKey('9')">9</button>
        <button class="key-btn" onclick="pressKey('4')">4</button>
        <button class="key-btn" onclick="pressKey('5')">5</button>
        <button class="key-btn" onclick="pressKey('6')">6</button>
        <button class="key-btn" onclick="pressKey('1')">1</button>
        <button class="key-btn" onclick="pressKey('2')">2</button>
        <button class="key-btn" onclick="pressKey('3')">3</button>
        <button class="key-btn key-ac" onclick="pressKey('AC')" aria-label="Clear All">AC</button>
        <button class="key-btn" onclick="pressKey('0')">0</button>
        <button class="key-btn key-back" onclick="pressKey('BACK')" aria-label="Backspace">
            <svg viewBox="0 0 24 24"><path d="M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.88 1.59.88h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-3 12.59L17.59 17 14 13.41 10.41 17 9 15.59 12.59 12 9 8.41 10.41 7 14 10.59 17.59 7 19 8.41 15.41 12 19 15.59z"/></svg>
        </button>
    </section>

</main>

<script>
    // --- STATE MANAGEMENT ---
    let rawPrice = ""; // Stores the typed string (e.g. "1250" -> 12.50)

    // --- ELEMENTS ---
    const elPrice = document.getElementById('display-price');
    const elSaved = document.getElementById('display-saved');
    const elTotal = document.getElementById('display-total');
    
    const inpDiscount = document.getElementById('discount-input');
    const sldDiscount = document.getElementById('discount-slider');
    
    const togTax = document.getElementById('tax-toggle');
    const inpTax = document.getElementById('tax-input');
    const boxTax = document.getElementById('tax-container');

    // --- KEYPAD LOGIC ---
    function pressKey(key) {
        if (key === 'AC') {
            rawPrice = "";
        } else if (key === 'BACK') {
            rawPrice = rawPrice.slice(0, -1);
        } else {
            // Limit to 9 digits to prevent overflow
            if (rawPrice.length < 9) {
                // Ignore leading zeros
                if (rawPrice === "" && key === "0") return;
                rawPrice += key;
            }
        }
        updateUI();
    }

    // --- CALCULATION LOGIC ---
    function updateUI() {
        // Convert raw string to currency float (implicit /100)
        // e.g., "123" -> 1.23
        let price = rawPrice ? parseInt(rawPrice) / 100 : 0;
        
        let discountPct = parseFloat(inpDiscount.value) || 0;
        let taxPct = parseFloat(inpTax.value) || 0;

        // Validation bounds
        if (discountPct < 0) discountPct = 0;
        if (discountPct > 100) discountPct = 100;

        // Math
        let saved = price * (discountPct / 100);
        let afterDiscount = price - saved;
        
        let taxAmt = 0;
        if (togTax.checked) {
            taxAmt = afterDiscount * (taxPct / 100);
            boxTax.style.opacity = '1';
        } else {
            boxTax.style.opacity = '0.3';
        }

        let total = afterDiscount + taxAmt;

        // Render
        const fmt = new Intl.NumberFormat('en-US', {
            style: 'decimal', 
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });

        elPrice.textContent = fmt.format(price);
        elSaved.textContent = fmt.format(saved);
        elTotal.textContent = fmt.format(total);
    }

    // --- EVENT LISTENERS ---

    // 1. Discount Slider <-> Input Sync
    inpDiscount.addEventListener('input', (e) => {
        let val = e.target.value;
        if (val > 100) val = 100;
        sldDiscount.value = val || 0;
        updateUI();
    });

    sldDiscount.addEventListener('input', (e) => {
        inpDiscount.value = e.target.value;
        updateUI();
    });

    // 2. Tax Toggle & Input
    togTax.addEventListener('change', updateUI);
    inpTax.addEventListener('input', updateUI);

    // 3. Service Worker Registration (Retain PWA)
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js').catch(() => {});
        });
    }

    // Initial render
    updateUI();

</script>

</body>
</html>
